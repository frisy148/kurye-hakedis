<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ kurye_adi }} - Hakedi≈ü Bilgileri</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="dashboard-container">
        <header class="dashboard-header">
            <div class="header-left">
                <h1>Hakedi≈ü Bilgileri</h1>
                <p class="welcome-text">Ho≈ü geldiniz, <strong>{{ kurye_adi }}</strong></p>
                <p class="week-info">D√∂nem: <strong>{{ selected_week }}</strong></p>
            </div>
            <div class="header-right">
                <div class="theme-toggle-container">
                    <button type="button" class="theme-switch theme-switch--ghost" aria-pressed="false" data-theme-toggle aria-label="Tema deƒüi≈ütir">
                        <span class="theme-switch__icon theme-switch__icon--sun">‚òÄÔ∏è</span>
                        <span class="theme-switch__icon theme-switch__icon--moon">üåô</span>
                    </button>
                </div>
                <a href="/" class="btn-logout">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                        <polyline points="16,17 21,12 16,7"/>
                        <line x1="21" y1="12" x2="9" y2="12"/>
                    </svg>
                </a>
            </div>
        </header>
        
        <main class="dashboard-content">
            {% if data %}
                {% for row in data %}
                
                {% if financial_summary %}
                {% set net_amount = financial_summary.net_balance %}
                <div class="finance-alert finance-alert--{{ financial_summary.status }}">
                    <div class="finance-alert-icon">
                        {% if financial_summary.status == 'positive' %}
                        üí∏
                        {% elif financial_summary.status == 'negative' %}
                        ‚ö†Ô∏è
                        {% else %}
                        üìÑ
                        {% endif %}
                    </div>
                    <div class="finance-alert-content">
                        {% if financial_summary.status == 'positive' %}
                        <p>Bu hafta hesabƒ±na <strong>{{ net_amount | round(0) | int }}‚Ç∫</strong> yatƒ±rƒ±lacak.</p>
                        {% elif financial_summary.status == 'negative' %}
                        <p>Bu hafta <strong>{{ (net_amount * -1) | round(0) | int }}‚Ç∫</strong> tutarƒ±nda borcun bulunuyor.</p>
                        {% else %}
                        <p>Bu hafta √∂denecek tutar dengede g√∂r√ºn√ºyor.</p>
                        {% endif %}
                        <span>Toplam hakedi≈ü: {{ financial_summary.total_earnings | round(0) | int }}‚Ç∫ ‚Ä¢ Kesinti toplamƒ±: {{ financial_summary.total_deductions | round(0) | int }}‚Ç∫</span>
                    </div>
                </div>
                {% endif %}
                
                {% if weekly_series or payment_reminder or company_overview or weekly_badges %}
                <section class="insight-section">
                    <div class="insight-grid">
                        {% if weekly_series %}
                        <div class="insight-card insight-card--chart">
                            <div class="insight-card-header">
                                <h2>Haftalƒ±k Performans</h2>
                                <p>Son haftalardaki paket ve hakedi≈ü deƒüi≈üimi</p>
                            </div>
                            <div class="insight-chart-wrapper">
                                <canvas id="weeklyTrendChart"></canvas>
                            </div>
                        </div>
                        {% endif %}
                        <div class="insight-column">
                            {% if target_info %}
                            <div class="insight-card insight-card--target" data-current-dropoff="{{ target_info.current | round(0) | int }}">
                                <div class="insight-card-header">
                                    <h2>Haftalƒ±k Hedefin</h2>
                                    <p>Daha √ßok paket i√ßin hedef belirle</p>
                                </div>
                                <div class="goal-progress" data-goal-current="{{ target_info.current | round(0) | int }}">
                                    <div class="goal-progress-bar">
                                        <div class="goal-progress-fill" data-goal-progress style="width: {{ target_info.progress | round(0) }}%;"></div>
                                    </div>
                                    <div class="goal-progress-meta">
                                        <span>≈ûu an: <strong data-goal-current>{{ target_info.current | round(0) | int }}</strong> paket</span>
                                        <span>Hedef: <strong data-goal-target>{{ target_info.goal | round(0) | int if target_info.goal else '‚Äî' }}</strong> paket</span>
                                    </div>
                                </div>
                                <form id="goal-form" class="goal-form" data-courier="{{ kurye_adi }}">
                                    <label>Haftalƒ±k hedefini g√ºncelle</label>
                                    <div class="goal-input">
                                        <input type="number" name="goal" min="0" step="1" value="{{ target_info.goal | round(0) | int if target_info.goal else '' }}" placeholder="√ñrn. 450">
                                        <button type="submit">Kaydet</button>
                                    </div>
                                    <input type="hidden" name="kurye_adi" value="{{ kurye_adi }}">
                                    <span class="goal-feedback" id="goal-feedback" aria-live="polite"></span>
                                </form>
                            </div>
                            {% endif %}
                            {% if payment_reminder %}
                            <div class="insight-card insight-card--reminder">
                                <div class="insight-card-header">
                                    <h2>Sƒ±radaki √ñdeme</h2>
                                    <p>{{ payment_reminder.week_range }}</p>
                                </div>
                                <div class="reminder-date">{{ payment_reminder.payment_date }}</div>
                                <div class="reminder-message reminder-message--{{ payment_reminder.status }}">
                                    {{ payment_reminder.message }}
                                </div>
                            </div>
                            {% endif %}
                            {% if company_overview %}
                            <div class="insight-card insight-card--summary">
                                <div class="insight-card-header">
                                    <h2>Aƒü Performansƒ±</h2>
                                    <p>{{ company_overview.week_label }}</p>
                                </div>
                                <ul class="summary-list">
                                    <li>
                                        <span>Toplam Dropoff</span>
                                        <strong>{{ company_overview.total_dropoff | int }}</strong>
                                    </li>
                                    <li>
                                        <span>Toplam Hakedi≈ü</span>
                                        <strong>{{ company_overview.total_earnings | round(0) | int }}‚Ç∫</strong>
                                    </li>
                                    <li>
                                        <span>Toplam √ñdeme</span>
                                        <strong>{{ company_overview.total_payout | round(0) | int }}‚Ç∫</strong>
                                    </li>
                                    <li>
                                        <span>Aktif Kurye</span>
                                        <strong>{{ company_overview.active_courier_count }}</strong>
                                    </li>
                                    <li>
                                        <span>Ortalama √ñdeme</span>
                                        <strong>{{ company_overview.average_payout | round(0) | int }}‚Ç∫</strong>
                                    </li>
                                </ul>
                            </div>
                            {% endif %}
                            {% if weekly_badges %}
                            <div class="insight-card insight-card--badges">
                                <div class="insight-card-header">
                                    <h2>Haftanƒ±n Rozetleri</h2>
                                    <p>Ekipte √∂ne √ßƒ±kan performanslar</p>
                                </div>
                                <ul class="badge-list">
                                    {% for badge in weekly_badges %}
                                    <li>
                                        <div class="badge-heading">
                                            <span class="badge-title">{{ badge.title }}</span>
                                            <span class="badge-value">{{ badge.value }} {{ badge.suffix }}</span>
                                        </div>
                                        <div class="badge-courier">{{ badge.courier }}</div>
                                        <p class="badge-desc">{{ badge.description }}</p>
                                    </li>
                                    {% endfor %}
                                </ul>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </section>
                {% endif %}
                
                <!-- Ana √ñzet Kartlarƒ± -->
                <div class="main-summary">
                    <div class="big-card total-card">
                        <div class="big-card-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                            </svg>
                        </div>
                        <div class="big-card-content">
                            <span class="big-card-label">Toplam Hakedi≈ü</span>
                            <span class="big-card-value">{{ "%.2f"|format(row[columns.index('Toplam Hakedi≈ü')] if 'Toplam Hakedi≈ü' in columns else 0) }} <small>‚Ç∫</small></span>
                        </div>
                    </div>
                    
                    <div class="big-card payment-card">
                        <div class="big-card-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
                                <line x1="1" y1="10" x2="23" y2="10"/>
                            </svg>
                        </div>
                        <div class="big-card-content">
                            <span class="big-card-label">√ñdenecek Tutar</span>
                            <span class="big-card-value highlight">{{ "%.2f"|format(row[columns.index('√ñdenecek Tutar')] if '√ñdenecek Tutar' in columns else 0) }} <small>‚Ç∫</small></span>
                        </div>
                    </div>
                </div>
                
                <!-- ƒ∞kincil √ñzet Kartlarƒ± -->
                <div class="card-grid">
                    <div class="summary-card deduction">
                        <div class="card-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="8" y1="12" x2="16" y2="12"/>
                            </svg>
                        </div>
                        <div class="card-info">
                            <span class="card-label">Toplam Kesinti</span>
                            <span class="card-value">{{ "%.2f"|format(row[columns.index('Toplam Kesinti Tutarƒ±')] if 'Toplam Kesinti Tutarƒ±' in columns else 0) }} ‚Ç∫</span>
                        </div>
                    </div>
                    
                    <div class="summary-card region">
                        <div class="card-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                                <circle cx="12" cy="10" r="3"/>
                            </svg>
                        </div>
                        <div class="card-info">
                            <span class="card-label">B√∂lge</span>
                            <span class="card-value region-name">{{ row[columns.index('B√∂lge')] if 'B√∂lge' in columns else '-' }}</span>
                        </div>
                    </div>
                    
                    {% if 'Pickup' in columns %}
                    <div class="summary-card pickup">
                        <div class="card-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                                <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                                <line x1="12" y1="22.08" x2="12" y2="12"/>
                            </svg>
                        </div>
                        <div class="card-info">
                            <span class="card-label">Pickup Sayƒ±sƒ±</span>
                            <span class="card-value">{{ row[columns.index('Pickup')] }}</span>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if 'Dropoff' in columns %}
                    <div class="summary-card dropoff">
                        <div class="card-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 16 14"/>
                            </svg>
                        </div>
                        <div class="card-info">
                            <span class="card-label">Dropoff Sayƒ±sƒ±</span>
                            <span class="card-value">{{ row[columns.index('Dropoff')] }}</span>
                        </div>
                    </div>
                    {% endif %}
                </div>
                
                <!-- KAZAN√áLAR B√ñL√úM√ú -->
                <div class="details-section">
                    <div class="section-header earnings-header">
                        <button type="button" class="section-toggle" data-section-toggle aria-expanded="true">
                            <span class="sr-only">Kazan√ßlar detayƒ±nƒ± a√ß/kapat</span>
                            <span aria-hidden="true" data-toggle-icon>‚àí</span>
                        </button>
                        <div class="section-title">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="1" x2="12" y2="23"/>
                                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                            </svg>
                            <h2>Kazan√ßlar</h2>
                        </div>
                    </div>
                    <div class="section-content" data-section-content>
                        <div class="detail-grid">
                        {% if 'Pickup Tutar' in columns %}
                        <div class="detail-item">
                            <span class="detail-label">Pickup Tutar</span>
                            <span class="detail-value positive">+{{ "%.2f"|format(row[columns.index('Pickup Tutar')]) }} ‚Ç∫</span>
                        </div>
                        {% endif %}
                        
                        {% if 'Dropoff Tutar' in columns %}
                        <div class="detail-item">
                            <span class="detail-label">Dropoff Tutar</span>
                            <span class="detail-value positive">+{{ "%.2f"|format(row[columns.index('Dropoff Tutar')]) }} ‚Ç∫</span>
                        </div>
                        {% endif %}
                        
                        {% if 'Mesafe Tutarƒ±' in columns %}
                        <div class="detail-item">
                            <span class="detail-label">Mesafe Tutarƒ±</span>
                            <span class="detail-value positive">+{{ "%.2f"|format(row[columns.index('Mesafe Tutarƒ±')]) }} ‚Ç∫</span>
                        </div>
                        {% endif %}
                        
                        {% if 'Garanti B√∂lge Tutarƒ±' in columns %}
                        <div class="detail-item">
                            <span class="detail-label">Garanti B√∂lge Tutarƒ±</span>
                            <span class="detail-value positive">+{{ "%.2f"|format(row[columns.index('Garanti B√∂lge Tutarƒ±')]) }} ‚Ç∫</span>
                        </div>
                        {% endif %}
                        
                        {% if 'Gece Mesaisi Tutarƒ±' in columns %}
                        <div class="detail-item">
                            <span class="detail-label">Gece Mesaisi Tutarƒ±</span>
                            <span class="detail-value positive">+{{ "%.2f"|format(row[columns.index('Gece Mesaisi Tutarƒ±')]) }} ‚Ç∫</span>
                        </div>
                        {% endif %}
                        
                        {% if 'B√∂lge Kampanya Tutarƒ±' in columns %}
                        <div class="detail-item">
                            <span class="detail-label">B√∂lge Kampanya Tutarƒ±</span>
                            <span class="detail-value positive">+{{ "%.2f"|format(row[columns.index('B√∂lge Kampanya Tutarƒ±')]) }} ‚Ç∫</span>
                        </div>
                        {% endif %}
                        
                        {% if 'Haftalƒ±k Ek Paket Tutarƒ±' in columns %}
                        <div class="detail-item">
                            <span class="detail-label">Haftalƒ±k Ek Paket</span>
                            <span class="detail-value positive">+{{ "%.2f"|format(row[columns.index('Haftalƒ±k Ek Paket Tutarƒ±')]) }} ‚Ç∫</span>
                        </div>
                        {% endif %}
                        
                        {% if 'G√ºnl√ºk Bonus' in columns %}
                        <div class="detail-item">
                            <span class="detail-label">G√ºnl√ºk Bonus</span>
                            <span class="detail-value positive">+{{ "%.2f"|format(row[columns.index('G√ºnl√ºk Bonus')]) }} ‚Ç∫</span>
                        </div>
                        {% endif %}
                        
                        {% if 'Hakedi≈ü Zam √ñdemesi KDV Dahil' in columns %}
                        <div class="detail-item">
                            <span class="detail-label">Hakedi≈ü Zam √ñdemesi (KDV Dahil)</span>
                            <span class="detail-value positive">+{{ "%.2f"|format(row[columns.index('Hakedi≈ü Zam √ñdemesi KDV Dahil')]) }} ‚Ç∫</span>
                        </div>
                        {% endif %}
                        
                        {% if 'Bah≈üi≈ü Tutar' in columns %}
                        <div class="detail-item">
                            <span class="detail-label">Bah≈üi≈ü Tutar</span>
                            <span class="detail-value positive">+{{ "%.2f"|format(row[columns.index('Bah≈üi≈ü Tutar')]) }} ‚Ç∫</span>
                        </div>
                        {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- KESƒ∞NTƒ∞LER B√ñL√úM√ú -->
                <div class="details-section">
                    <div class="section-header deductions-header">
                        <button type="button" class="section-toggle" data-section-toggle aria-expanded="true">
                            <span class="sr-only">Kesintiler detayƒ±nƒ± a√ß/kapat</span>
                            <span aria-hidden="true" data-toggle-icon>‚àí</span>
                        </button>
                        <div class="section-title">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <line x1="8" y1="12" x2="16" y2="12"/>
                            </svg>
                            <h2>Kesintiler</h2>
                        </div>
                    </div>
                    <div class="section-content" data-section-content>
                        <div class="detail-grid">
                        {% if 'Tevkifat Tutar' in columns %}
                        <div class="detail-item">
                            <span class="detail-label">Tevkifat Tutar</span>
                            <span class="detail-value negative">-{{ "%.2f"|format(row[columns.index('Tevkifat Tutar')]) }} ‚Ç∫</span>
                        </div>
                        {% endif %}
                        
                        {% if 'Nakit' in columns %}
                        <div class="detail-item">
                            <span class="detail-label">Nakit</span>
                            <span class="detail-value negative">-{{ "%.2f"|format(row[columns.index('Nakit')]) }} ‚Ç∫</span>
                        </div>
                        {% endif %}
                        
                        {% if 'Kredi Kartƒ±' in columns %}
                        <div class="detail-item">
                            <span class="detail-label">Kredi Kartƒ±</span>
                            <span class="detail-value negative">-{{ "%.2f"|format(row[columns.index('Kredi Kartƒ±')]) }} ‚Ç∫</span>
                        </div>
                        {% endif %}
                        
                        {% if 'Sigorta Kesintisi' in columns %}
                        <div class="detail-item">
                            <span class="detail-label">Sigorta Kesintisi</span>
                            <span class="detail-value negative">-{{ "%.2f"|format(row[columns.index('Sigorta Kesintisi')]) }} ‚Ç∫</span>
                        </div>
                        {% endif %}
                        
                        {% if 'Ssk, ƒ∞≈ü G√ºvenlik Kesintisi' in columns %}
                        <div class="detail-item">
                            <span class="detail-label">SSK, ƒ∞≈ü G√ºvenlik Kesintisi</span>
                            <span class="detail-value negative">-{{ "%.2f"|format(row[columns.index('Ssk, ƒ∞≈ü G√ºvenlik Kesintisi')]) }} ‚Ç∫</span>
                        </div>
                        {% endif %}
                        
                        {% if 'Saha Kesintileri' in columns %}
                        <div class="detail-item">
                            <span class="detail-label">Saha Kesintileri</span>
                            <span class="detail-value negative">-{{ "%.2f"|format(row[columns.index('Saha Kesintileri')]) }} ‚Ç∫</span>
                        </div>
                        {% endif %}
                        
                        {% if 'Ekipman Kesintisi' in columns %}
                        <div class="detail-item">
                            <span class="detail-label">Ekipman Kesintisi</span>
                            <span class="detail-value negative">-{{ "%.2f"|format(row[columns.index('Ekipman Kesintisi')]) }} ‚Ç∫</span>
                        </div>
                        {% endif %}
                        
                        {% if 'ƒ∞ade Edilmesi Gereken Maa≈ü Tutarƒ±' in columns %}
                        <div class="detail-item">
                            <span class="detail-label">ƒ∞ade Edilmesi Gereken Maa≈ü</span>
                            <span class="detail-value negative">-{{ "%.2f"|format(row[columns.index('ƒ∞ade Edilmesi Gereken Maa≈ü Tutarƒ±')]) }} ‚Ç∫</span>
                        </div>
                        {% endif %}
                        
                        {% if 'Yemeksepeti ƒ∞ade' in columns %}
                        <div class="detail-item">
                            <span class="detail-label">Yemeksepeti ƒ∞ade</span>
                            <span class="detail-value negative">-{{ "%.2f"|format(row[columns.index('Yemeksepeti ƒ∞ade')]) }} ‚Ç∫</span>
                        </div>
                        {% endif %}
                        </div>
                        {% if financial_summary.deduction_breakdown %}
                        <div class="deduction-breakdown">
                            <h3>Kesinti √ñzeti</h3>
                            <ul>
                                {% for item in financial_summary.deduction_breakdown %}
                                <li>
                                    <span>{{ item.label }}</span>
                                    <strong>{{ item.amount | round(0) | int }}‚Ç∫</strong>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- √ñZET B√ñL√úM√ú -->
                <div class="final-summary">
                    <div class="summary-row">
                        <span class="summary-label">Toplam Hakedi≈ü</span>
                        <span class="summary-value positive">{{ "%.2f"|format(row[columns.index('Toplam Hakedi≈ü')] if 'Toplam Hakedi≈ü' in columns else 0) }} ‚Ç∫</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">Toplam Kesinti</span>
                        <span class="summary-value negative">-{{ "%.2f"|format(row[columns.index('Toplam Kesinti Tutarƒ±')] if 'Toplam Kesinti Tutarƒ±' in columns else 0) }} ‚Ç∫</span>
                    </div>
                    <div class="summary-divider"></div>
                    <div class="summary-row final">
                        <span class="summary-label">√ñdenecek Tutar</span>
                        <span class="summary-value final-value">{{ "%.2f"|format(row[columns.index('√ñdenecek Tutar')] if '√ñdenecek Tutar' in columns else 0) }} ‚Ç∫</span>
                    </div>
                </div>
                
                {% endfor %}
            {% else %}
                <div class="no-data">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="8" x2="12" y2="12"/>
                        <line x1="12" y1="16" x2="12.01" y2="16"/>
                    </svg>
                    <p>Veri bulunamadƒ±.</p>
                </div>
            {% endif %}
        </main>
        
        <footer class="dashboard-footer">
            <p>¬© 2026 Kurye Hakedi≈ü Sistemi</p>
        </footer>
    </div>
    <script src="{{ url_for('static', filename='theme.js') }}?v=1"></script>
    {% if weekly_series %}
    <script id="weekly-series-data" type="application/json">{{ weekly_series | tojson }}</script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    {% endif %}
    <script src="{{ url_for('static', filename='dashboard.js') }}?v=1"></script>
</body>
</html>
